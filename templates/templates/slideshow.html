<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Our Love Story ðŸ’– - Slideshow</title>
<link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
<style>
body { margin:0; padding:0; background:black; font-family:sans-serif; overflow-x:hidden; color:white; text-align:center; }
#slideshow-container { margin-top:20px; position:relative; z-index:2; }
img { max-width:90%; border-radius:10px; display:block; margin:20px auto; z-index:2; position:relative; }
canvas { position:fixed; top:0; left:0; z-index:0; pointer-events:none; }
</style>
</head>
<body>

<!-- HIDDEN AUDIO IFRAME -->
<iframe src="{{ url_for('audio') }}" style="display:none;" id="musicFrame"></iframe>

<!-- HEARTS CANVAS -->
<canvas id="hearts"></canvas>

<!-- SLIDESHOW -->
<div id="slideshow-container">
    <img id="slide" src="/static/images/{{ images[0] }}">
</div>

<script>
const images = {{ images|tojson }};
let slideIndex = 0;

// HEART RAIN
const heartCanvas = document.getElementById("hearts");
const hctx = heartCanvas.getContext("2d");
heartCanvas.width = window.innerWidth;
heartCanvas.height = window.innerHeight;
let hearts = [];

window.addEventListener("resize", () => { heartCanvas.width = window.innerWidth; heartCanvas.height = window.innerHeight; });

function drawHeart(ctx, x, y, size, color){
    ctx.save(); ctx.fillStyle=color; ctx.beginPath();
    let topCurve = size*0.3;
    ctx.moveTo(x, y+topCurve);
    ctx.bezierCurveTo(x, y, x-size/2, y, x-size/2, y+topCurve);
    ctx.bezierCurveTo(x-size/2, y+(size+topCurve)/2, x, y+(size+topCurve)/1.5, x, y+size);
    ctx.bezierCurveTo(x, y+(size+topCurve)/1.5, x+size/2, y+(size+topCurve)/2, x+size/2, y+topCurve);
    ctx.bezierCurveTo(x+size/2, y, x, y, x, y+topCurve);
    ctx.closePath(); ctx.fill(); ctx.restore();
}

function createHearts(){ hearts.push({x:Math.random()*heartCanvas.width, y:-20, size:Math.random()*15+10, vy:1+Math.random()*3, color:`hsl(${Math.random()*360},100%,70%)`}); }
function animateHearts(){ hctx.clearRect(0,0,heartCanvas.width,heartCanvas.height); hearts.forEach((h,i)=>{ h.y+=h.vy; drawHeart(hctx,h.x,h.y,h.size,h.color); if(h.y>heartCanvas.height) hearts.splice(i,1); }); requestAnimationFrame(animateHearts); }
setInterval(createHearts,150);
animateHearts();

// SLIDESHOW FUNCTION
function nextImage(){
    slideIndex++;
    if(slideIndex < images.length){
        document.getElementById("slide").src="/static/images/"+images[slideIndex];
    } else {
        window.location.href = "{{ url_for('question') }}"; // redirect after last image
    }
}

setInterval(nextImage,3000);
</script>
</body>
</html>
